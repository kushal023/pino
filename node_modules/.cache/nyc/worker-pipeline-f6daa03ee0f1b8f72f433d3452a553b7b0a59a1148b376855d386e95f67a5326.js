'use strict';const EE=require('events');const loadTransportStreamBuilder=require('./transport-stream');const{pipeline,PassThrough}=require('stream');// This file is not checked by the code coverage tool,
// as it is not reliable.
/* istanbul ignore file */module.exports=async function({targets}){const streams=await Promise.all(targets.map(async t=>{const fn=await loadTransportStreamBuilder(t.target);const stream=await fn(t.options);return stream;}));const ee=new EE();const stream=new PassThrough({autoDestroy:true,destroy(_,cb){ee.on('error',cb);ee.on('closed',cb);}});pipeline(stream,...streams,function(err){if(err&&err.code!=='ERR_STREAM_PREMATURE_CLOSE'){ee.emit('error',err);return;}ee.emit('closed');});return stream;};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJFRSIsInJlcXVpcmUiLCJsb2FkVHJhbnNwb3J0U3RyZWFtQnVpbGRlciIsInBpcGVsaW5lIiwiUGFzc1Rocm91Z2giLCJtb2R1bGUiLCJleHBvcnRzIiwidGFyZ2V0cyIsInN0cmVhbXMiLCJQcm9taXNlIiwiYWxsIiwibWFwIiwidCIsImZuIiwidGFyZ2V0Iiwic3RyZWFtIiwib3B0aW9ucyIsImVlIiwiYXV0b0Rlc3Ryb3kiLCJkZXN0cm95IiwiXyIsImNiIiwib24iLCJlcnIiLCJjb2RlIiwiZW1pdCJdLCJzb3VyY2VzIjpbIndvcmtlci1waXBlbGluZS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCdcblxuY29uc3QgRUUgPSByZXF1aXJlKCdldmVudHMnKVxuY29uc3QgbG9hZFRyYW5zcG9ydFN0cmVhbUJ1aWxkZXIgPSByZXF1aXJlKCcuL3RyYW5zcG9ydC1zdHJlYW0nKVxuY29uc3QgeyBwaXBlbGluZSwgUGFzc1Rocm91Z2ggfSA9IHJlcXVpcmUoJ3N0cmVhbScpXG5cbi8vIFRoaXMgZmlsZSBpcyBub3QgY2hlY2tlZCBieSB0aGUgY29kZSBjb3ZlcmFnZSB0b29sLFxuLy8gYXMgaXQgaXMgbm90IHJlbGlhYmxlLlxuXG4vKiBpc3RhbmJ1bCBpZ25vcmUgZmlsZSAqL1xuXG5tb2R1bGUuZXhwb3J0cyA9IGFzeW5jIGZ1bmN0aW9uICh7IHRhcmdldHMgfSkge1xuICBjb25zdCBzdHJlYW1zID0gYXdhaXQgUHJvbWlzZS5hbGwodGFyZ2V0cy5tYXAoYXN5bmMgKHQpID0+IHtcbiAgICBjb25zdCBmbiA9IGF3YWl0IGxvYWRUcmFuc3BvcnRTdHJlYW1CdWlsZGVyKHQudGFyZ2V0KVxuICAgIGNvbnN0IHN0cmVhbSA9IGF3YWl0IGZuKHQub3B0aW9ucylcbiAgICByZXR1cm4gc3RyZWFtXG4gIH0pKVxuICBjb25zdCBlZSA9IG5ldyBFRSgpXG5cbiAgY29uc3Qgc3RyZWFtID0gbmV3IFBhc3NUaHJvdWdoKHtcbiAgICBhdXRvRGVzdHJveTogdHJ1ZSxcbiAgICBkZXN0cm95IChfLCBjYikge1xuICAgICAgZWUub24oJ2Vycm9yJywgY2IpXG4gICAgICBlZS5vbignY2xvc2VkJywgY2IpXG4gICAgfVxuICB9KVxuXG4gIHBpcGVsaW5lKHN0cmVhbSwgLi4uc3RyZWFtcywgZnVuY3Rpb24gKGVycikge1xuICAgIGlmIChlcnIgJiYgZXJyLmNvZGUgIT09ICdFUlJfU1RSRUFNX1BSRU1BVFVSRV9DTE9TRScpIHtcbiAgICAgIGVlLmVtaXQoJ2Vycm9yJywgZXJyKVxuICAgICAgcmV0dXJuXG4gICAgfVxuXG4gICAgZWUuZW1pdCgnY2xvc2VkJylcbiAgfSlcblxuICByZXR1cm4gc3RyZWFtXG59XG4iXSwibWFwcGluZ3MiOiJBQUFBLFlBQVksQ0FFWixLQUFNLENBQUFBLEVBQUUsQ0FBR0MsT0FBTyxDQUFDLFFBQVEsQ0FBQyxDQUM1QixLQUFNLENBQUFDLDBCQUEwQixDQUFHRCxPQUFPLENBQUMsb0JBQW9CLENBQUMsQ0FDaEUsS0FBTSxDQUFFRSxRQUFRLENBQUVDLFdBQVksQ0FBQyxDQUFHSCxPQUFPLENBQUMsUUFBUSxDQUFDLENBRW5EO0FBQ0E7QUFFQSwwQkFFQUksTUFBTSxDQUFDQyxPQUFPLENBQUcsZUFBZ0IsQ0FBRUMsT0FBUSxDQUFDLENBQUUsQ0FDNUMsS0FBTSxDQUFBQyxPQUFPLENBQUcsS0FBTSxDQUFBQyxPQUFPLENBQUNDLEdBQUcsQ0FBQ0gsT0FBTyxDQUFDSSxHQUFHLENBQUMsS0FBTyxDQUFBQyxDQUFDLEVBQUssQ0FDekQsS0FBTSxDQUFBQyxFQUFFLENBQUcsS0FBTSxDQUFBWCwwQkFBMEIsQ0FBQ1UsQ0FBQyxDQUFDRSxNQUFNLENBQUMsQ0FDckQsS0FBTSxDQUFBQyxNQUFNLENBQUcsS0FBTSxDQUFBRixFQUFFLENBQUNELENBQUMsQ0FBQ0ksT0FBTyxDQUFDLENBQ2xDLE1BQU8sQ0FBQUQsTUFBTSxDQUNmLENBQUMsQ0FBQyxDQUFDLENBQ0gsS0FBTSxDQUFBRSxFQUFFLENBQUcsR0FBSSxDQUFBakIsRUFBRSxDQUFDLENBQUMsQ0FFbkIsS0FBTSxDQUFBZSxNQUFNLENBQUcsR0FBSSxDQUFBWCxXQUFXLENBQUMsQ0FDN0JjLFdBQVcsQ0FBRSxJQUFJLENBQ2pCQyxPQUFPQSxDQUFFQyxDQUFDLENBQUVDLEVBQUUsQ0FBRSxDQUNkSixFQUFFLENBQUNLLEVBQUUsQ0FBQyxPQUFPLENBQUVELEVBQUUsQ0FBQyxDQUNsQkosRUFBRSxDQUFDSyxFQUFFLENBQUMsUUFBUSxDQUFFRCxFQUFFLENBQUMsQ0FDckIsQ0FDRixDQUFDLENBQUMsQ0FFRmxCLFFBQVEsQ0FBQ1ksTUFBTSxDQUFFLEdBQUdQLE9BQU8sQ0FBRSxTQUFVZSxHQUFHLENBQUUsQ0FDMUMsR0FBSUEsR0FBRyxFQUFJQSxHQUFHLENBQUNDLElBQUksR0FBSyw0QkFBNEIsQ0FBRSxDQUNwRFAsRUFBRSxDQUFDUSxJQUFJLENBQUMsT0FBTyxDQUFFRixHQUFHLENBQUMsQ0FDckIsT0FDRixDQUVBTixFQUFFLENBQUNRLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FDbkIsQ0FBQyxDQUFDLENBRUYsTUFBTyxDQUFBVixNQUFNLENBQ2YsQ0FBQyJ9